<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy-Saving Notifications</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="logo">Home Automation</div>
        <ul>
            <li><a href="/"><i class="fas fa-home"></i> Home</a></li>
            <li><a href="/features"><i class="fas fa-cogs"></i> Features</a></li>
            <li><a href="/chat"><i class="fas fa-comments"></i> Chat with ChatGPT</a></li>
            <li><a href="/dashboard"><i class="fas fa-chart-line"></i> Dashboard</a></li>
            <li><a href="/notifications" class="active"><i class="fas fa-bell"></i> Notifications</a></li>
            <li><a href="/login"><i class="fas fa-user"></i> Login</a></li>
            <li><a href="/about"><i class="fas fa-info-circle"></i> About Us</a></li>
            <li><a href="/contact"><i class="fas fa-envelope"></i> Contact Us</a></li>
        </ul>
    </div>

    <!-- Hamburger menu -->
    <div class="toggle-btn" onclick="toggleSidebar()">
        &#9776;
    </div>

    <!-- Main content -->
    <div class="main-content" id="main-content">
        <section class="notifications-container">
            <h3>Energy-Saving Notifications and AI Advice</h3>

            <!-- Dropdown for advice groups -->
            <label for="advice-group">Select Advice Group:</label>
            <select id="advice-group" onchange="fetchNotifications()">
                <% groups.forEach(group => { %>
                    <option value="<%= group.GroupID %>"><%= group.GroupName %></option>
                <% }); %>
            </select>

            <button id="show-top-10" onclick="fetchTopAdvice()">Show Top 10 Advice</button>

            <div class="notifications-grid" id="notifications-grid">
                <% if (notifications.length === 0) { %>
                    <div class="notification-card no-data">
                        <i class="fas fa-info-circle"></i>
                        <p>No notifications available at the moment.</p>
                    </div>
                <% } else { %>
                    <% notifications.forEach(notification => { %>
                        <div class="notification-card">
                            <i class="fas fa-lightbulb"></i>
                            <p><%= notification %></p>
                        </div>
                    <% }); %>
                <% } %>
            </div>
        </section>
    </div>

    <script>
        // Function to fetch notifications for the selected group
function fetchNotifications() {
    const groupId = document.getElementById('advice-group').value;

    fetch(`/notifications?group=${groupId}`)
        .then((response) => {
            if (!response.ok) {
                throw new Error('Failed to fetch notifications.');
            }
            return response.json();
        })
        .then((data) => {
            const notificationsGrid = document.getElementById('notifications-grid');
            notificationsGrid.innerHTML = ''; // Clear existing notifications

            if (data.notifications.length === 0) {
                notificationsGrid.innerHTML = `
                    <div class="notification-card no-data">
                        <i class="fas fa-info-circle"></i>
                        <p>No notifications available at the moment.</p>
                    </div>
                `;
            } else {
                data.notifications.forEach((notification) => {
                    const notificationCard = document.createElement('div');
                    notificationCard.className = 'notification-card';
                    notificationCard.innerHTML = `
                        <i class="fas fa-lightbulb"></i>
                        <p>${notification}</p>
                    `;
                    notificationsGrid.appendChild(notificationCard);
                });
            }
        })
        .catch((error) => {
            console.error('Error fetching notifications:', error);
            alert('Failed to fetch notifications. Please try again later.');
        });
}

// Function to fetch Top 10 Advice
// Function to fetch Top 10 Advice
function fetchTopAdvice() {
    fetch('/notifications/top')
        .then((response) => {
            if (!response.ok) {
                throw new Error('Failed to fetch top advice.');
            }
            return response.json();
        })
        .then((data) => {
            const notificationsGrid = document.getElementById('notifications-grid');
            notificationsGrid.innerHTML = ''; // Clear existing notifications

            if (data.topAdvice.length === 0) {
                notificationsGrid.innerHTML = `
                    <div class="notification-card no-data">
                        <i class="fas fa-info-circle"></i>
                        <p>No top advice available at the moment.</p>
                    </div>
                `;
            } else {
                const container = document.createElement('div');
                container.className = 'top-advice-container';

                const title = document.createElement('div');
                title.className = 'top-advice-title';
                title.textContent = 'Top 10 Energy-Saving Advice';
                container.appendChild(title);

                data.topAdvice.forEach((advice) => {
                    const adviceCard = document.createElement('div');
                    adviceCard.className = 'advice-card';

                    const [roomNumber, ...adviceParts] = advice.split(':');
                    const adviceText = adviceParts.join(':').trim();

                    const room = document.createElement('div');
                    room.className = 'room-number';
                    room.textContent = roomNumber.trim();

                    const adviceContent = document.createElement('div');
                    adviceContent.className = 'advice-text';
                    adviceContent.textContent = adviceText;

                    adviceCard.appendChild(room);
                    adviceCard.appendChild(adviceContent);

                    container.appendChild(adviceCard);
                });

                notificationsGrid.appendChild(container);
            }
        })
        .catch((error) => {
            console.error('Error fetching top advice:', error);
            alert('Failed to fetch top advice. Please try again later.');
        });
}



    </script>
    <script src="/js/frontend.js"></script>
</body>
</html>
