<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> - Home Automation Dashboard</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="logo">Home Automation</div>
        <ul>
            <li><a href="/"><i class="fas fa-home"></i> Home</a></li>
            <li><a href="/features"><i class="fas fa-cogs"></i> Features</a></li>
            <li><a href="/chat"><i class="fas fa-comments"></i> Chat with ChatGPT</a></li>
            <li><a href="/dashboard"><i class="fas fa-chart-line"></i> Dashboard</a></li>
            <li><a href="/notifications"><i class="fas fa-bell"></i> Notifications</a></li>
            <li><a href="/login"><i class="fas fa-user"></i> Login</a></li>
            <li><a href="/about"><i class="fas fa-info-circle"></i> About Us</a></li>
            <li><a href="/contact"><i class="fas fa-envelope"></i> Contact Us</a></li>
        </ul>
    </div>

     <!-- Hamburger menu -->
     <div class="toggle-btn" onclick="toggleSidebar()">
        &#9776;
    </div>
    
    <!-- Main content -->
    <div class="main-content" id="main-content">
        <section class="chat-container">
            <div class="card">
                <h3>Ask ChatGPT for Home Automation Tips</h3>
                <div id="chatHistory" class="chat-history">
                    <!-- Chat history will be displayed here -->
                </div>
                <div class="chat-input-container">
                    <input type="text" id="userInput" placeholder="Ask ChatGPT..." aria-label="User input for ChatGPT" />
                    <button onclick="askChatGPT()" aria-label="Send question to ChatGPT">Ask</button>
                </div>
            </div>
        </section>
    </div>

    <script src="/js/frontend.js"></script>
    <script>
        // Store conversation history in an array
        const chatHistory = [];

        async function askChatGPT() {
            const userInput = document.getElementById('userInput').value;

            if (userInput.trim() === "") {
                displayMessage("Please enter a question.", "system");
                return;
            }

            // Display user's message
            displayMessage(userInput, "user");
            document.getElementById('userInput').value = ""; // Clear input

            try {
                const response = await fetch('/ask-chatgpt', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ input: userInput })
                });

                const data = await response.json();
                const chatGPTResponse = data.response ? data.response : "No response received from ChatGPT.";

                // Display ChatGPT's response
                displayMessage(chatGPTResponse, "chatgpt");
            } catch (error) {
                console.error('Error fetching response from ChatGPT:', error);
                displayMessage("Sorry, there was an error communicating with ChatGPT. Please try again later.", "system");
            }
        }

        // Function to display messages in the chat history
        function displayMessage(text, sender) {
            const chatHistoryDiv = document.getElementById('chatHistory');

            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender);

            if (sender === "user") {
                messageDiv.classList.add('message', 'user');
                messageDiv.style.textAlign = "right";
                messageDiv.style.color = "blue";
            } else if (sender === "chatgpt") {
                messageDiv.classList.add('message', 'chatgpt');
                messageDiv.style.textAlign = "left";
                messageDiv.style.color = "green";
            } else if (sender === "system") {
                messageDiv.classList.add('message', 'system');
                messageDiv.style.textAlign = "center";
                messageDiv.style.color = "gray";
            }

            messageDiv.innerText = text;
            chatHistoryDiv.appendChild(messageDiv);

            // Scroll to the bottom of the chat history
            chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight;

            // Add message to chat history array
            chatHistory.push({ sender, text });
        }
    </script>
    
</body>
</html>
